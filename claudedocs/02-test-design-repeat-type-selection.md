# Agent 2: 테스트 설계 - 반복 유형 선택

**작성일**: 2025-10-31
**Agent**: Test Design Agent (Agent 2)
**상태**: 완료 ✅

---

## Phase 1.5: 명세 품질 검증

### 검증 결과: ✅ **통과 (5/5)**

Agent 1이 작성한 명세 `specs/09-recurring-events.md`를 검증한 결과, 모든 항목이 통과하여 테스트 설계를 즉시 진행할 수 있습니다.

#### 1. ✅ Given-When-Then 패턴 준수

- **근거 (사실)**: RR-GEN-001~007 총 7개 규칙이 모두 G-W-T 형식으로 작성됨
- **근거 (평가)**: 모든 시나리오가 명확한 구조를 가지며 일관성 있음
- **근거 (대안)**: 없음 (충분히 준수)

#### 2. ✅ 구체적 예시 포함

- **근거 (사실)**: 7개 규칙 모두에 JSON 입력/출력 예시 포함
  - 매일 반복: `["2025-01-01", "2025-01-02", ..., "2025-01-05"]`
  - 31일 매월: `["2025-01-31", "2025-03-31", "2025-05-31"]`
  - 윤년 2월 29일: `["2024-02-29", "2028-02-29"]`
- **근거 (평가)**: 입출력이 JSON 형식으로 명확히 제시되어 테스트 데이터 생성 가능
- **근거 (대안)**: 없음 (구체적 예시 충분)

#### 3. ✅ 엣지 케이스 명시

- **근거 (사실)**:
  - 31일 매월 반복 (RR-GEN-004): 31일이 없는 달(2월, 4월, 6월, 9월, 11월) 건너뛰기
  - 윤년 2월 29일 매년 반복 (RR-GEN-006): 평년 건너뛰기
  - 일정 겹침 무시 (RR-GEN-007)
- **근거 (평가)**: 주요 예외 케이스가 모두 명시됨
- **근거 (대안)**: 없음 (충분한 커버리지)

#### 4. ✅ 테스트 가능 여부

- **근거 (사실)**:
  - 각 규칙에 구체적인 입력값 (날짜, 반복 유형, 종료일) 제공
  - 각 규칙에 예상 출력 (생성되는 날짜 배열) 명시
- **근거 (평가)**: 명세를 읽고 즉시 테스트 케이스 작성 가능
- **근거 (대안)**: 없음 (테스트 가능)

#### 5. ✅ 범위 준수

- **근거 (사실)**:
  - 요구사항: 반복 유형 선택 (매일, 매주, 매월, 매년) + UI
  - 명세: RR-SELECT (2개), RR-GEN (7개), RR-UI (2개)
- **근거 (평가)**: 요구사항 범위 내 명세 작성 (추가 기능 없음)
- **근거 (대안)**: 없음 (범위 준수)

---

## Phase 2: 테스트 구조 설계

### 2.1 단위 테스트 구조

**파일**: `src/__tests__/unit/easy.repeatUtils.spec.ts`

**테스트 대상 함수**:

1. `generateDailyDates(startDate: string, endDate: string): string[]`
2. `generateWeeklyDates(startDate: string, endDate: string): string[]`
3. `generateMonthlyDates(startDate: string, endDate: string): string[]`
4. `generateYearlyDates(startDate: string, endDate: string): string[]`
5. `isLeapYear(year: number): boolean` (헬퍼 함수)

#### 테스트 케이스 구조

```typescript
describe('generateDailyDates', () => {
  it('시작일부터 종료일까지 매일 날짜를 생성한다', () => {
    // Given: 2025-01-01 시작, 2025-01-05 종료
    // When: generateDailyDates 호출
    // Then: 5개 날짜 배열 반환 (01-01 ~ 01-05)
  });

  it('시작일과 종료일이 같으면 1개 날짜만 생성한다', () => {
    // Given: 2025-01-01 시작, 2025-01-01 종료
    // When: generateDailyDates 호출
    // Then: 1개 날짜 배열 반환
  });
});

describe('generateWeeklyDates', () => {
  it('시작일의 요일과 같은 요일에 매주 날짜를 생성한다', () => {
    // Given: 2025-01-06 (월요일) 시작, 2025-01-27 종료
    // When: generateWeeklyDates 호출
    // Then: 4개 월요일 날짜 반환 (01-06, 01-13, 01-20, 01-27)
  });

  it('종료일까지 주가 부족하면 마지막 날짜를 포함하지 않는다', () => {
    // Given: 2025-01-06 (월요일) 시작, 2025-01-10 (금요일) 종료
    // When: generateWeeklyDates 호출
    // Then: 1개 날짜만 반환 (01-06)
  });
});

describe('generateMonthlyDates', () => {
  it('시작일의 날짜와 같은 날짜에 매월 날짜를 생성한다', () => {
    // Given: 2025-01-15 시작, 2025-04-15 종료
    // When: generateMonthlyDates 호출
    // Then: 4개 날짜 반환 (01-15, 02-15, 03-15, 04-15)
  });

  it('31일 매월 반복 시 31일이 없는 달은 건너뛴다', () => {
    // Given: 2025-01-31 시작, 2025-06-30 종료
    // When: generateMonthlyDates 호출
    // Then: 3개 날짜 반환 (01-31, 03-31, 05-31)
    // And: 2월(28일), 4월(30일) 건너뜀
  });

  it('31일 매월 반복 시 1년 전체 생성하면 7개 날짜 반환', () => {
    // Given: 2025-01-31 시작, 2025-12-31 종료
    // When: generateMonthlyDates 호출
    // Then: 7개 날짜 반환 (1월, 3월, 5월, 7월, 8월, 10월, 12월)
  });

  it('30일 매월 반복 시 2월만 건너뛴다', () => {
    // Given: 2025-01-30 시작, 2025-04-30 종료
    // When: generateMonthlyDates 호출
    // Then: 3개 날짜 반환 (01-30, 03-30, 04-30)
    // And: 2월(28일) 건너뜀
  });

  it('28일 매월 반복 시 모든 달에 날짜를 생성한다', () => {
    // Given: 2025-01-28 시작, 2025-12-28 종료
    // When: generateMonthlyDates 호출
    // Then: 12개 날짜 반환 (모든 달)
  });
});

describe('generateYearlyDates', () => {
  it('시작일의 월/일과 같은 날짜에 매년 날짜를 생성한다', () => {
    // Given: 2025-01-15 시작, 2027-12-31 종료
    // When: generateYearlyDates 호출
    // Then: 3개 날짜 반환 (2025-01-15, 2026-01-15, 2027-01-15)
  });

  it('윤년 2월 29일 매년 반복 시 평년을 건너뛴다', () => {
    // Given: 2024-02-29 시작, 2030-12-31 종료
    // When: generateYearlyDates 호출
    // Then: 2개 날짜 반환 (2024-02-29, 2028-02-29)
    // And: 2025, 2026, 2027, 2029, 2030 평년 건너뜀
  });

  it('윤년 2월 29일 매년 반복 시 9년 범위에서 3개 날짜 생성', () => {
    // Given: 2024-02-29 시작, 2032-12-31 종료
    // When: generateYearlyDates 호출
    // Then: 3개 날짜 반환 (2024, 2028, 2032)
  });

  it('일반 날짜 매년 반복은 모든 연도에 생성한다', () => {
    // Given: 2025-03-15 시작, 2029-12-31 종료
    // When: generateYearlyDates 호출
    // Then: 5개 날짜 반환 (2025~2029)
  });
});

describe('isLeapYear', () => {
  it('4로 나누어떨어지고 100으로 나누어떨어지지 않으면 윤년이다', () => {
    // Given: 2024, 2028, 2032
    // When: isLeapYear 호출
    // Then: true 반환
  });

  it('400으로 나누어떨어지면 윤년이다', () => {
    // Given: 2000, 2400
    // When: isLeapYear 호출
    // Then: true 반환
  });

  it('100으로 나누어떨어지지만 400으로 나누어떨어지지 않으면 평년이다', () => {
    // Given: 1900, 2100, 2200
    // When: isLeapYear 호출
    // Then: false 반환
  });

  it('4로 나누어떨어지지 않으면 평년이다', () => {
    // Given: 2025, 2026, 2027, 2029
    // When: isLeapYear 호출
    // Then: false 반환
  });
});
```

---

### 2.2 통합 테스트 구조

**파일**: `src/__tests__/medium.integration.spec.tsx`

**새로운 describe 블록 추가**: `describe('반복 일정 기능', () => { ... })`

#### 테스트 케이스 구조

```typescript
describe('반복 일정 기능', () => {
  describe('반복 유형 선택 UI', () => {
    it('반복 설정 체크박스를 활성화하면 반복 유형 Select가 표시된다', () => {
      // Given: 일정 생성 폼 렌더링
      // When: "반복 설정" 체크박스 클릭
      // Then: "반복 유형" Select 표시
      // And: "매일", "매주", "매월", "매년" 옵션 확인
    });

    it('반복 유형 Select에서 매일을 선택할 수 있다', () => {
      // Given: 반복 설정 활성화
      // When: "반복 유형" Select 클릭 → "매일" 선택
      // Then: "매일" 옵션이 선택됨
    });

    it('반복 종료일 입력 필드가 표시된다', () => {
      // Given: 반복 설정 활성화
      // When: "반복 종료일" 입력 필드 확인
      // Then: 날짜 입력 필드 표시
    });
  });

  describe('매일 반복 일정 생성', () => {
    it('매일 반복 일정 생성 시 여러 이벤트가 생성된다', () => {
      // Given: 2025-01-01 매일 반복 (종료: 2025-01-05)
      // When: "일정 추가" 버튼 클릭
      // Then: POST /api/events-list 호출 (5개 이벤트)
      // And: 이벤트 목록에 5개 일정 표시
    });

    it('매일 반복 일정에 Repeat 아이콘이 표시된다', () => {
      // Given: 매일 반복 일정 생성 완료
      // When: 캘린더 뷰 확인
      // Then: 일정 제목 옆에 Repeat 아이콘 표시
    });
  });

  describe('매주 반복 일정 생성', () => {
    it('매주 반복 일정 생성 시 같은 요일에 일정이 생성된다', () => {
      // Given: 2025-01-06 (월요일) 매주 반복 (종료: 2025-01-27)
      // When: "일정 추가" 버튼 클릭
      // Then: 4개 월요일 일정 생성 (01-06, 01-13, 01-20, 01-27)
    });
  });

  describe('매월 반복 일정 생성', () => {
    it('일반 날짜 매월 반복 시 모든 달에 일정이 생성된다', () => {
      // Given: 2025-01-15 매월 반복 (종료: 2025-04-15)
      // When: "일정 추가" 버튼 클릭
      // Then: 4개 일정 생성 (01-15, 02-15, 03-15, 04-15)
    });

    it('31일 매월 반복 시 31일이 없는 달은 건너뛴다', () => {
      // Given: 2025-01-31 매월 반복 (종료: 2025-06-30)
      // When: "일정 추가" 버튼 클릭
      // Then: 3개 일정 생성 (01-31, 03-31, 05-31)
      // And: 2월, 4월, 6월 건너뜀
    });

    it('31일 매월 반복 전체 연도 생성 시 7개 일정 생성', () => {
      // Given: 2025-01-31 매월 반복 (종료: 2025-12-31)
      // When: "일정 추가" 버튼 클릭
      // Then: 7개 일정 생성 (1월, 3월, 5월, 7월, 8월, 10월, 12월)
    });
  });

  describe('매년 반복 일정 생성', () => {
    it('일반 날짜 매년 반복 시 매년 일정이 생성된다', () => {
      // Given: 2025-01-15 매년 반복 (종료: 2027-12-31)
      // When: "일정 추가" 버튼 클릭
      // Then: 3개 일정 생성 (2025, 2026, 2027)
    });

    it('윤년 2월 29일 매년 반복 시 평년을 건너뛴다', () => {
      // Given: 2024-02-29 매년 반복 (종료: 2030-12-31)
      // When: "일정 추가" 버튼 클릭
      // Then: 2개 일정 생성 (2024, 2028)
      // And: 2025, 2026, 2027, 2029, 2030 건너뜀
    });
  });

  describe('반복 일정 아이콘 표시', () => {
    it('반복 일정에 Repeat 아이콘이 표시된다', () => {
      // Given: 반복 일정이 캘린더에 표시됨
      // When: 일정 목록 확인
      // Then: 일정 제목 옆에 Repeat 아이콘 표시
    });

    it('반복되지 않는 일정은 Repeat 아이콘이 표시되지 않는다', () => {
      // Given: 일반 일정(repeat.type: 'none')이 캘린더에 표시됨
      // When: 일정 목록 확인
      // Then: Repeat 아이콘 표시 안함
    });
  });

  describe('일정 겹침 무시', () => {
    it('반복 일정 생성 시 겹침 경고 없이 즉시 생성된다', () => {
      // Given: 2025-01-01 10:00-12:00 기존 일정
      // And: 2025-01-01 11:00-13:00 매일 반복 생성
      // When: "일정 추가" 버튼 클릭
      // Then: 겹침 경고 다이얼로그 표시 안함
      // And: 즉시 반복 일정 생성
      // And: 기존 일정과 반복 일정 모두 존재
    });
  });
});
```

---

## Phase 3: 테스트 데이터 Fixtures

**파일**: `src/__tests__/__fixtures__/mockRecurringEvents.ts`

**생성 조건**: ✅ 복잡한 데이터 (10개 이상 필드), 2회 이상 재사용

**Fixtures 내용**:

1. `mock31DayMonthlyEvent` - 31일 매월 반복 테스트용
2. `mockLeapYearEvent` - 윤년 2월 29일 매년 반복 테스트용
3. `mockDailyEvent` - 매일 반복 테스트용
4. `mockWeeklyEvent` - 매주 반복 테스트용
5. `mockRegularMonthlyEvent` - 일반 매월 반복 테스트용

---

## Phase 4: Agent 3에게 전달할 내용

### 테스트 작성 우선순위

#### 1. 단위 테스트 (최우선)

- `generateMonthlyDates` - 31일 매월 반복 케이스 집중
- `generateYearlyDates` - 윤년 2월 29일 케이스 집중
- `isLeapYear` - 윤년 판단 헬퍼 (기초 로직)
- `generateDailyDates` - 기본 반복 로직
- `generateWeeklyDates` - 요일 기반 반복

#### 2. 통합 테스트

- 반복 UI 표시 확인
- 31일 매월 반복 E2E 시나리오
- 윤년 2월 29일 매년 반복 E2E 시나리오
- 일정 겹침 무시 시나리오

### 엣지 케이스 체크리스트

- [ ] 31일 매월 반복 시 2월 건너뛰기 (평년 28일, 윤년 29일)
- [ ] 31일 매월 반복 시 30일 달 건너뛰기 (4월, 6월, 9월, 11월)
- [ ] 윤년 2월 29일 매년 반복 시 평년 건너뛰기
- [ ] 윤년 판단 로직 (4로 나누어떨어지고, 100으로 나누어떨어지지 않거나 400으로 나누어떨어짐)
- [ ] 일정 겹침 무시 (BR-OVERLAP-001 규칙 적용 안함)

### 테스트 작성 가이드

**Given-When-Then 패턴 필수**:

```typescript
it('31일 매월 반복 시 31일이 없는 달은 건너뛴다', () => {
  // Given: 2025-01-31 시작, 2025-06-30 종료
  const startDate = '2025-01-31';
  const endDate = '2025-06-30';

  // When: 매월 날짜 생성
  const dates = generateMonthlyDates(startDate, endDate);

  // Then: 3개 날짜 반환 (1월, 3월, 5월)
  expect(dates).toEqual([
    '2025-01-31',
    '2025-03-31',
    '2025-05-31'
  ]);
});
```

**Testing Library 쿼리 우선순위**:

1. `getByRole` (접근성 쿼리 최우선)
2. `getByLabelText` (폼 입력 필드)
3. `getByTestId` (최후의 수단)

**기존 테스트 패턴 참조**:

- `src/__tests__/unit/easy.dateUtils.spec.ts` - 날짜 유틸 테스트 패턴
- `src/__tests__/medium.integration.spec.tsx` - 통합 테스트 패턴

---

## ✅ 완료 체크리스트

- [x] **Phase 1.5**: 명세 품질 검증 (5/5 통과)
- [x] **Phase 2.1**: 단위 테스트 구조 설계
  - [x] generateDailyDates (2개 케이스)
  - [x] generateWeeklyDates (2개 케이스)
  - [x] generateMonthlyDates (5개 케이스)
  - [x] generateYearlyDates (4개 케이스)
  - [x] isLeapYear (4개 케이스)
- [x] **Phase 2.2**: 통합 테스트 구조 설계
  - [x] 반복 UI 표시 (3개 케이스)
  - [x] 매일 반복 생성 (2개 케이스)
  - [x] 매주 반복 생성 (1개 케이스)
  - [x] 매월 반복 생성 (3개 케이스)
  - [x] 매년 반복 생성 (2개 케이스)
  - [x] 반복 아이콘 표시 (2개 케이스)
  - [x] 일정 겹침 무시 (1개 케이스)
- [x] **Phase 3**: 테스트 데이터 fixtures 생성
- [x] **Phase 4**: 테스트 설계 문서 작성

---

## 🎯 핵심 포인트

### 반드시 테스트해야 할 케이스

1. **31일 매월 반복** (RR-GEN-004)
   - 2월(28/29일), 4월, 6월, 9월, 11월(30일) 건너뛰기
   - 1월, 3월, 5월, 7월, 8월, 10월, 12월만 생성

2. **윤년 2월 29일 매년 반복** (RR-GEN-006)
   - 평년(2025, 2026, 2027, ...) 건너뛰기
   - 윤년(2024, 2028, 2032, ...) 만 생성

3. **일정 겹침 무시** (RR-GEN-007)
   - 반복 일정 생성 시 BR-OVERLAP-001 규칙 적용 안함
   - 겹침 경고 다이얼로그 표시 안함

---

**Agent 2 작업 완료** ✅

**다음**: Agent 3 (Red Phase Agent) 실행
