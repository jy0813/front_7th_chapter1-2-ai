# Agent 1: 기능 설계 - 반복 유형 선택

**작성일**: 2025-10-30
**Agent**: Feature Design Agent (Agent 1)
**상태**: 완료 ✅

---

## 📋 작업 범위 정리

### 프로젝트 분석 결과

#### 1. 기존 프로젝트 구조 분석

**디렉토리 구조**:

```
src/
├── App.tsx              # 메인 컴포넌트 (UI 주석 해제 필요: 441-478줄)
├── types.ts             # RepeatInfo 타입 정의 (이미 존재)
├── utils/
│   ├── dateUtils.ts     # 날짜 유틸 (기존 활용)
│   └── (신규) repeatUtils.ts  # 반복 날짜 생성 로직 (생성 필요)
├── hooks/
│   ├── useEventForm.ts       # 폼 상태 관리 (반복 상태 추가 필요)
│   └── useEventOperations.ts # API 호출 (반복 일정 API 추가)
└── __tests__/
    ├── unit/
    │   └── (신규) easy.repeatUtils.spec.ts
    └── medium.integration.spec.tsx (반복 UI 테스트 추가)
```

#### 2. 반복 일정 기능 영향 범위

**영향을 미치는 부분**:

1. **일정 생성 로직** (`App.tsx`, `useEventForm.ts`)
   - 반복 UI 주석 해제 (441-478줄)
   - 반복 설정 상태 관리
   - 반복 일정 생성 시 여러 이벤트 생성

2. **서버 API** (`server.js`)
   - ✅ **이미 구현됨**: `POST /api/events-list` (여러 일정 동시 생성)
   - 클라이언트에서 호출만 추가하면 됨

3. **일정 표시 UI** (캘린더 뷰, 일정 목록)
   - 반복 일정 아이콘 표시 (Material-UI Repeat 아이콘)
   - 반복 일정과 일반 일정 구분

**영향을 미치지 않는 부분**:

- 기존 일정 CRUD 로직 (단일 일정)
- 일정 겹침 감지 (반복 일정은 겹침 무시)
- 알림 시스템 (반복 일정도 동일하게 작동)
- 검색 기능 (반복 일정도 검색 대상)

#### 3. 수정 필요 파일 목록

**신규 생성**:

- [ ] `src/utils/repeatUtils.ts` - 반복 날짜 생성 로직
- [ ] `src/__tests__/unit/easy.repeatUtils.spec.ts` - 단위 테스트
- [ ] `src/__tests__/__fixtures__/mockRecurringEvents.ts` - 테스트 데이터
- [ ] `specs/09-recurring-events.md` - 명세 문서 ✅ (완료)

**수정 필요**:

- [ ] `src/App.tsx` - UI 주석 해제 (441-478줄)
- [ ] `src/hooks/useEventForm.ts` - 반복 상태 관리 추가
- [ ] `src/hooks/useEventOperations.ts` - POST /api/events-list 호출 추가
- [ ] `src/__tests__/medium.integration.spec.tsx` - 통합 테스트 추가

**수정 불필요** (이미 완성):

- `src/types.ts` - RepeatInfo 타입 정의 (이미 존재)
- `server.js` - POST /api/events-list 엔드포인트 (이미 구현)

---

## 📝 명세 문서 작성 완료

### 작성된 문서

#### `specs/09-recurring-events.md` ✅

**섹션 구성**:

1. 개요
2. 반복 유형 선택 (RR-SELECT-001, RR-SELECT-002)
3. 반복 생성 로직 (RR-GEN-001 ~ RR-GEN-007)
   - 매일 반복 (RR-GEN-001)
   - 매주 반복 (RR-GEN-002)
   - 매월 반복 일반 (RR-GEN-003)
   - ⭐️ **매월 반복 31일 케이스** (RR-GEN-004)
   - 매년 반복 일반 (RR-GEN-005)
   - ⭐️ **매년 반복 윤년 2월 29일 케이스** (RR-GEN-006)
   - ⭐️ **일정 겹침 무시** (RR-GEN-007)
4. UI 명세 (RR-UI-001, RR-UI-002)
5. 테스트 시나리오 (3개)

**특수 케이스 명세**:

1. **31일 매월 반복 (RR-GEN-004)**:
   - 입력: 2025-01-31
   - 출력: 1월, 3월, 5월, 7월, 8월, 10월, 12월만 생성
   - 건너뜀: 2월(28일), 4월, 6월, 9월, 11월(30일)

2. **윤년 2월 29일 매년 반복 (RR-GEN-006)**:
   - 입력: 2024-02-29
   - 출력: 2024, 2028, 2032 (윤년만)
   - 건너뜀: 2025, 2026, 2027, 2029, 2030, 2031 (평년)

3. **일정 겹침 무시 (RR-GEN-007)**:
   - 반복 일정 생성 시 기존 일정과의 겹침 확인 안함
   - 겹침 경고 다이얼로그 표시 안함

**Given-When-Then 시나리오**:

- 모든 규칙에 구체적인 G-W-T 시나리오 포함
- 입력/출력 JSON 예시 명확히 제공
- 테스트 가능한 수준의 상세도

---

## ✅ 품질 검증 (8개 항목)

### 1. ✅ 패턴 준수

- **근거 (사실)**: 시나리오 1-3이 모두 Given-When-Then 형식
- **근거 (평가)**: 모든 시나리오가 명확한 G-W-T 구조
- **근거 (대안)**: 없음 (충분히 준수)

### 2. ✅ 완전성

- **근거 (사실)**: 정상 케이스 5개, 예외 케이스 2개(31일, 윤년)
- **근거 (평가)**: 주요 예외 케이스 모두 포함
- **근거 (대안)**: 없음 (충분한 커버리지)

### 3. ✅ 구체성

- **근거 (사실)**: 모든 시나리오에 JSON 입출력 예시 포함
- **근거 (평가)**: 입출력이 명확하고 구체적
- **근거 (대안)**: 없음 (구체적 예시 충분)

### 4. ✅ 명확성

- **근거 (사실)**: "건너뛰기", "무시" 등 명확한 용어 사용
- **근거 (평가)**: 모든 표현이 구체적이고 명확
- **근거 (대안)**: 없음 (모호한 표현 없음)

### 5. ✅ 범위 준수

- **근거 (사실)**: 요구사항 5개 vs 명세 7개(RR-GEN-001~007)
- **근거 (평가)**: 요구사항만 다루고 추가 기능 없음
- **근거 (대안)**: 없음 (범위 준수)

### 6. ✅ 구현 가능성

- **근거 (사실)**: 각 규칙에 구체적인 알고리즘 명시
- **근거 (평가)**: Agent 2-5가 즉시 구현 가능
- **근거 (대안)**: 없음 (구현 가능 수준)

### 7. ✅ 테스트 가능성

- **근거 (사실)**: 3개 시나리오 모두 검증 가능한 입출력 포함
- **근거 (평가)**: 명확한 입출력으로 테스트 작성 가능
- **근거 (대안)**: 없음 (테스트 가능)

### 8. ✅ 예시 충분성

- **근거 (사실)**: 7개 규칙 모두에 JSON/코드 예시 포함
- **근거 (평가)**: 모든 주요 시나리오와 엣지 케이스 예시 포함
- **근거 (대안)**: 없음 (예시 충분)

---

## 📋 체크리스트

### 구현해야 할 기능 목록

- [x] **명세 작성**
  - [x] specs/09-recurring-events.md 생성
  - [x] 반복 유형 선택 명세 (RR-SELECT-001, 002)
  - [x] 반복 생성 로직 명세 (RR-GEN-001~007)
  - [x] 31일 매월 반복 특수 케이스 (RR-GEN-004)
  - [x] 윤년 2월 29일 매년 반복 특수 케이스 (RR-GEN-006)
  - [x] 일정 겹침 무시 규칙 (RR-GEN-007)
  - [x] UI 명세 (RR-UI-001, 002)
  - [x] 테스트 시나리오 3개

- [ ] **다음 단계** (Agent 2-5가 수행)
  - [ ] 테스트 구조 설계 (Agent 2)
  - [ ] 단위 테스트 작성 (Agent 3)
  - [ ] 구현 코드 작성 (Agent 4)
  - [ ] 리팩토링 (Agent 5)

---

## 🎯 핵심 포인트

### 반드시 기억해야 할 사항

1. **UI 주석 해제 필수**: App.tsx 441-478줄 주석 해제
2. **31일 케이스**: 31일이 없는 달(2월, 4월, 6월, 9월, 11월) 건너뜀
3. **윤년 케이스**: 평년(2025, 2026, 2027, ...)은 2월 29일 건너뜀
4. **일정 겹침 무시**: 반복 일정은 겹침 확인 안함
5. **여러 이벤트 생성**: POST /api/events-list 사용
6. **동일 repeat.id**: 같은 반복 일정은 동일한 repeat.id 공유

---

## 🚀 다음 단계

### Agent 2 (테스트 설계)에게 전달할 내용

1. **명세 문서 참조**: `specs/09-recurring-events.md`
2. **테스트 우선순위**:
   - 단위 테스트: repeatUtils.ts (7개 함수)
   - 통합 테스트: UI 상호작용 + API 호출
3. **엣지 케이스 집중**:
   - 31일 매월 반복
   - 윤년 2월 29일 매년 반복
   - 일정 겹침 무시

---

**Agent 1 작업 완료** ✅

**다음**: Agent 2 (테스트 설계 Agent) 실행
