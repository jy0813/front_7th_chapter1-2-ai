# 09. 반복 일정 명세

**문서 버전**: 1.0.0
**최종 업데이트**: 2025-10-30
**상태**: 구현 필요

---

## 📋 목차

1. [개요](#개요)
2. [반복 유형 선택](#반복-유형-선택)
3. [반복 생성 로직](#반복-생성-로직)
4. [UI 명세](#ui-명세)
5. [테스트 시나리오](#테스트-시나리오)

---

## 개요

### 문서 목적

반복 일정 기능의 요구사항을 정의합니다. 특히 31일 매월 반복과 윤년 2월 29일 매년 반복의 특수 케이스 처리 방법을 명시합니다.

### 핵심 원칙

1. **특수 케이스 명확화**: 31일, 윤년 2월 29일 등 예외 상황 명확히 정의
2. **일정 겹침 무시**: 반복일정은 일정 겹침을 고려하지 않음
3. **UI 주석 해제**: App.tsx의 주석 처리된 반복 UI 활용

---

## 반복 유형 선택

### RR-SELECT-001: 반복 유형 옵션

**규칙**: 일정 생성 또는 수정 시 4가지 반복 유형 선택 가능

**반복 유형**:

| 값        | 표시   | 설명                          |
| --------- | ------ | ----------------------------- |
| `daily`   | 매일   | 매일 반복                     |
| `weekly`  | 매주   | 매주 같은 요일에 반복         |
| `monthly` | 매월   | 매월 같은 날짜에 반복         |
| `yearly`  | 매년   | 매년 같은 월/일에 반복        |

**구현 위치**: `src/App.tsx` (441-454 줄, 주석 해제 필요)

**Given-When-Then 시나리오**:

```gherkin
Given: 사용자가 일정 생성 폼에서 "반복 설정" 체크박스를 활성화
When: "반복 유형" Select를 클릭
Then: "매일", "매주", "매월", "매년" 4가지 옵션 표시
```

---

### RR-SELECT-002: 반복 종료 조건

**규칙**: 반복 종료일은 최대 2025-12-31까지 설정 가능

**제약사항**:
- 반복 종료일은 반복 시작일(일정 날짜) 이후여야 함
- 최대 종료일: `2025-12-31`
- 최소 종료일: 일정의 `date` 필드 값

**Given-When-Then 시나리오**:

```gherkin
Given: 사용자가 2025-01-31에 매월 반복 일정을 생성
When: 반복 종료일을 입력하지 않음
Then: 기본값으로 2025-12-31까지 반복 일정 생성
```

---

## 반복 생성 로직

### RR-GEN-001: 매일 반복

**규칙**: 시작일부터 종료일까지 매일 일정 생성

**입력 예시**:
```json
{
  "date": "2025-01-01",
  "repeat": {
    "type": "daily",
    "interval": 1,
    "endDate": "2025-01-05"
  }
}
```

**출력 예시** (생성되는 일정 날짜 목록):
```json
["2025-01-01", "2025-01-02", "2025-01-03", "2025-01-04", "2025-01-05"]
```

**Given-When-Then 시나리오**:

```gherkin
Given: 2025-01-01에 매일 반복 일정을 생성
And: 반복 종료일이 2025-01-05
When: "일정 추가" 버튼 클릭
Then: 2025-01-01부터 2025-01-05까지 총 5개 일정 생성
And: 모든 일정은 동일한 repeat.id를 공유
```

---

### RR-GEN-002: 매주 반복

**규칙**: 시작일의 요일과 같은 요일에 매주 일정 생성

**입력 예시**:
```json
{
  "date": "2025-01-06",
  "repeat": {
    "type": "weekly",
    "interval": 1,
    "endDate": "2025-01-27"
  }
}
```

**출력 예시** (월요일 반복):
```json
["2025-01-06", "2025-01-13", "2025-01-20", "2025-01-27"]
```

**Given-When-Then 시나리오**:

```gherkin
Given: 2025-01-06 (월요일)에 매주 반복 일정을 생성
And: 반복 종료일이 2025-01-27
When: "일정 추가" 버튼 클릭
Then: 매주 월요일(1/6, 1/13, 1/20, 1/27)에 총 4개 일정 생성
And: 모든 일정은 동일한 repeat.id를 공유
```

---

### RR-GEN-003: 매월 반복 (일반 케이스)

**규칙**: 시작일의 날짜와 같은 날짜에 매월 일정 생성

**입력 예시**:
```json
{
  "date": "2025-01-15",
  "repeat": {
    "type": "monthly",
    "interval": 1,
    "endDate": "2025-04-15"
  }
}
```

**출력 예시**:
```json
["2025-01-15", "2025-02-15", "2025-03-15", "2025-04-15"]
```

**Given-When-Then 시나리오**:

```gherkin
Given: 2025-01-15에 매월 반복 일정을 생성
And: 반복 종료일이 2025-04-15
When: "일정 추가" 버튼 클릭
Then: 매월 15일(1/15, 2/15, 3/15, 4/15)에 총 4개 일정 생성
And: 모든 일정은 동일한 repeat.id를 공유
```

---

### RR-GEN-004: 매월 반복 (31일 특수 케이스) ⭐️

**규칙**: 31일에 매월 반복 선택 시, 31일이 없는 달은 **건너뛰기**

**31일이 없는 달**: 2월(28/29일), 4월(30일), 6월(30일), 9월(30일), 11월(30일)

**입력 예시**:
```json
{
  "date": "2025-01-31",
  "repeat": {
    "type": "monthly",
    "interval": 1,
    "endDate": "2025-06-30"
  }
}
```

**출력 예시** (31일이 있는 달만 생성):
```json
["2025-01-31", "2025-03-31", "2025-05-31"]
```

**건너뛴 달**: 2월(28일), 4월(30일)

**Given-When-Then 시나리오**:

```gherkin
Given: 2025-01-31 (31일)에 매월 반복 일정을 생성
And: 반복 종료일이 2025-06-30
When: "일정 추가" 버튼 클릭
Then: 1월 31일, 3월 31일, 5월 31일에만 일정 생성 (총 3개)
And: 2월(28일), 4월(30일)은 건너뜀
And: 6월은 30일까지만 있으므로 생성 안함
```

**예외 처리**: 윤년 2월도 29일까지만 있으므로 31일 반복은 건너뜀

---

### RR-GEN-005: 매년 반복 (일반 케이스)

**규칙**: 시작일의 월/일과 같은 날짜에 매년 일정 생성

**입력 예시**:
```json
{
  "date": "2025-01-15",
  "repeat": {
    "type": "yearly",
    "interval": 1,
    "endDate": "2027-12-31"
  }
}
```

**출력 예시**:
```json
["2025-01-15", "2026-01-15", "2027-01-15"]
```

**Given-When-Then 시나리오**:

```gherkin
Given: 2025-01-15에 매년 반복 일정을 생성
And: 반복 종료일이 2027-12-31
When: "일정 추가" 버튼 클릭
Then: 매년 1월 15일(2025, 2026, 2027)에 총 3개 일정 생성
And: 모든 일정은 동일한 repeat.id를 공유
```

---

### RR-GEN-006: 매년 반복 (윤년 2월 29일 특수 케이스) ⭐️

**규칙**: 2월 29일(윤년)에 매년 반복 선택 시, **다음 윤년까지 건너뛰기**

**윤년 조건**: 연도가 4로 나누어떨어지고 (100으로 나누어떨어지지 않거나 400으로 나누어떨어짐)

**윤년 예시**: 2020, 2024, 2028, 2032, ...

**입력 예시**:
```json
{
  "date": "2024-02-29",
  "repeat": {
    "type": "yearly",
    "interval": 1,
    "endDate": "2030-12-31"
  }
}
```

**출력 예시** (윤년만 생성):
```json
["2024-02-29", "2028-02-29"]
```

**건너뛴 연도**: 2025 (평년), 2026 (평년), 2027 (평년), 2029 (평년), 2030 (평년)

**Given-When-Then 시나리오**:

```gherkin
Given: 2024-02-29 (윤년)에 매년 반복 일정을 생성
And: 반복 종료일이 2030-12-31
When: "일정 추가" 버튼 클릭
Then: 2024-02-29, 2028-02-29에만 일정 생성 (총 2개)
And: 2025, 2026, 2027, 2029, 2030은 평년이므로 건너뜀
And: 모든 일정은 동일한 repeat.id를 공유
```

---

### RR-GEN-007: 일정 겹침 무시 ⭐️

**규칙**: 반복 일정 생성 시 기존 일정과의 겹침을 **고려하지 않음**

**이유**: 반복 일정은 대량 생성되므로 모든 겹침을 확인하면 성능 저하

**동작**:
- 반복 일정 생성 시 `BR-OVERLAP-001` (일정 겹침 감지) 규칙 적용 안함
- 겹침 경고 다이얼로그 표시 안함
- 즉시 서버에 저장

**Given-When-Then 시나리오**:

```gherkin
Given: 2025-01-01 10:00-12:00에 기존 일정이 있음
And: 2025-01-01 11:00-13:00 매일 반복 일정을 생성
When: "일정 추가" 버튼 클릭
Then: 겹침 경고 없이 즉시 반복 일정 생성
And: 기존 일정과 반복 일정이 동시에 존재
```

---

## UI 명세

### RR-UI-001: 반복 설정 UI 주석 해제

**규칙**: App.tsx의 주석 처리된 반복 UI 코드를 주석 해제하여 사용

**위치**: `src/App.tsx` 441-478 줄

**포함 컴포넌트**:
1. 반복 유형 Select (441-455줄)
2. 반복 간격 TextField (456-466줄)
3. 반복 종료일 TextField (467-475줄)

**Given-When-Then 시나리오**:

```gherkin
Given: 사용자가 일정 생성 폼에서
When: 코드 441-478줄의 주석을 해제
Then: "반복 유형", "반복 간격", "반복 종료일" 입력 필드 표시
```

---

### RR-UI-002: 반복 아이콘 표시

**규칙**: 반복 일정은 캘린더 뷰에서 아이콘으로 구분 표시

**아이콘**: Material-UI의 `Repeat` 아이콘 사용

**표시 위치**: 일정 제목 옆

**Given-When-Then 시나리오**:

```gherkin
Given: 매일 반복 일정이 캘린더 뷰에 표시됨
When: 사용자가 일정 목록을 확인
Then: 일정 제목 옆에 Repeat 아이콘(🔁) 표시
And: 반복되지 않는 일정은 아이콘 표시 안함
```

---

## 테스트 시나리오

### 시나리오 1: 31일 매월 반복

**목적**: 31일 매월 반복 시 31일이 없는 달 건너뛰기 검증

**입력**:
```typescript
{
  date: "2025-01-31",
  repeat: {
    type: "monthly",
    interval: 1,
    endDate: "2025-12-31"
  }
}
```

**예상 출력** (생성되는 날짜):
```typescript
[
  "2025-01-31",
  "2025-03-31",
  "2025-05-31",
  "2025-07-31",
  "2025-08-31",
  "2025-10-31",
  "2025-12-31"
]
```

**검증**:
- 2월, 4월, 6월, 9월, 11월은 건너뜀
- 총 7개 일정 생성
- 모든 일정은 동일한 `repeat.id` 공유

---

### 시나리오 2: 윤년 2월 29일 매년 반복

**목적**: 윤년 2월 29일 매년 반복 시 평년 건너뛰기 검증

**입력**:
```typescript
{
  date: "2024-02-29",
  repeat: {
    type: "yearly",
    interval: 1,
    endDate: "2032-12-31"
  }
}
```

**예상 출력** (윤년만):
```typescript
[
  "2024-02-29",
  "2028-02-29",
  "2032-02-29"
]
```

**검증**:
- 2025, 2026, 2027, 2029, 2030, 2031은 평년이므로 건너뜀
- 총 3개 일정 생성 (4년 주기)
- 모든 일정은 동일한 `repeat.id` 공유

---

### 시나리오 3: 일정 겹침 무시

**목적**: 반복 일정 생성 시 겹침 경고 없이 즉시 생성

**전제 조건**:
- 기존 일정: 2025-01-01 10:00-12:00

**입력**:
```typescript
{
  date: "2025-01-01",
  startTime: "11:00",
  endTime: "13:00",
  repeat: {
    type: "daily",
    interval: 1,
    endDate: "2025-01-03"
  }
}
```

**예상 동작**:
- 겹침 경고 다이얼로그 표시 안함
- 즉시 3개 일정 생성 (1/1, 1/2, 1/3)
- 1/1 일정은 기존 일정과 겹치지만 생성됨

---

## 품질 검증 (Agent 1 자체 검증)

### ✅ 1. 패턴 준수

- **근거 (사실)**: 시나리오 1-3이 모두 Given-When-Then 형식으로 작성됨
- **근거 (평가)**: 모든 시나리오가 명확한 G-W-T 구조를 가짐
- **근거 (대안)**: 없음 (충분히 준수)

### ✅ 2. 완전성

- **근거 (사실)**: 정상 케이스 5개(일반 반복), 예외 케이스 2개(31일, 윤년)
- **근거 (평가)**: 주요 예외 케이스(31일, 윤년) 포함
- **근거 (대안)**: 없음 (충분한 커버리지)

### ✅ 3. 구체성

- **근거 (사실)**: 모든 시나리오에 JSON 입력/출력 예시 포함
- **근거 (평가)**: 입출력이 명확하고 구체적
- **근거 (대안)**: 없음 (구체적 예시 충분)

### ✅ 4. 명확성

- **근거 (사실)**: "건너뛰기", "무시" 등 명확한 용어 사용, 모호한 표현 없음
- **근거 (평가)**: 모든 표현이 구체적이고 명확함
- **근거 (대안)**: 없음 (모호한 표현 없음)

### ✅ 5. 범위 준수

- **근거 (사실)**: 요구사항 5개(매일, 매주, 매월, 매년, UI) vs 명세 7개(RR-GEN-001~007)
- **근거 (평가)**: 요구사항만 다루고 추가 기능 없음
- **근거 (대안)**: 없음 (범위 준수)

### ✅ 6. 구현 가능성

- **근거 (사실)**: 각 규칙에 구체적인 알고리즘(날짜 생성, 윤년 판단) 명시
- **근거 (평가)**: Agent 2-5가 즉시 구현 가능
- **근거 (대안)**: 없음 (구현 가능 수준)

### ✅ 7. 테스트 가능성

- **근거 (사실)**: 3개 시나리오 모두 검증 가능한 입출력 예시 포함
- **근거 (평가)**: 명확한 입출력으로 테스트 케이스 작성 가능
- **근거 (대안)**: 없음 (테스트 가능)

### ✅ 8. 예시 충분성

- **근거 (사실)**: 7개 규칙 모두에 JSON/코드 예시 포함
- **근거 (평가)**: 모든 주요 시나리오와 엣지 케이스 예시 포함
- **근거 (대안)**: 없음 (예시 충분)

---

## 참조

- **관련 명세**:
  - [01. 데이터 모델](./01-data-models.md): RepeatInfo 타입 정의
  - [02. 비즈니스 규칙](./02-business-rules.md): 반복 일정 규칙
  - [04. API 명세](./04-api-specification.md): POST /api/events-list 엔드포인트
  - [08. 테스트 시나리오](./08-test-scenarios.md): 통합 테스트 시나리오

---

**다음 단계**: Agent 2 (테스트 설계 Agent) - 테스트 구조 설계 및 fixtures 생성
