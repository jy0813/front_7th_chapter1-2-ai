# 03. 사용자 워크플로우 명세

**문서 버전**: 1.0.0
**최종 업데이트**: 2025-10-27

---

## 📋 목차

1. [개요](#개요)
2. [WF-01: 일정 생성 워크플로우](#wf-01-일정-생성-워크플로우)
3. [WF-02: 일정 수정 워크플로우](#wf-02-일정-수정-워크플로우)
4. [WF-03: 일정 삭제 워크플로우](#wf-03-일정-삭제-워크플로우)
5. [WF-04: 일정 검색 워크플로우](#wf-04-일정-검색-워크플로우)
6. [WF-05: 캘린더 뷰 전환 워크플로우](#wf-05-캘린더-뷰-전환-워크플로우)
7. [WF-06: 일정 겹침 경고 처리 워크플로우](#wf-06-일정-겹침-경고-처리-워크플로우)

---

## 개요

### 문서 목적

사용자가 시스템과 상호작용하는 모든 주요 시나리오를 단계별로 정의합니다. 각 워크플로우는 Given-When-Then 형식으로 작성되어 테스트 가능하며, AI가 UI 플로우를 이해하고 구현할 수 있도록 상세히 기술합니다.

### 워크플로우 표기법

- **Given**: 시작 전 상태 (전제 조건)
- **When**: 사용자 액션 (트리거)
- **Then**: 예상 결과 (결과 상태)
- **And**: 추가 조건 또는 결과

---

## WF-01: 일정 생성 워크플로우

### 시나리오 1: 정상적인 일정 생성

#### Given (전제 조건)
- 사용자가 일정 관리 페이지에 접근
- 좌측 "일정 추가" 폼이 표시됨
- 모든 필드가 기본값으로 초기화됨:
  - 제목: 빈 문자열
  - 날짜: 빈 문자열
  - 시작 시간: 빈 문자열
  - 종료 시간: 빈 문자열
  - 설명: 빈 문자열
  - 위치: 빈 문자열
  - 카테고리: "업무"
  - 알림 설정: "10분 전"

#### When (사용자 액션)
1. **제목 입력**: "팀 회의" 입력
2. **날짜 선택**: "2025-10-27" 입력
3. **시작 시간 입력**: "14:00" 입력
4. **종료 시간 입력**: "15:00" 입력
5. **설명 입력**: "Q4 프로젝트 진행 상황 리뷰" 입력 (선택적)
6. **위치 입력**: "회의실 B" 입력 (선택적)
7. **카테고리 선택**: "업무" 유지 (기본값)
8. **알림 설정**: "10분 전" 유지 (기본값)
9. **"일정 추가" 버튼 클릭**

#### Then (예상 결과)
1. **서버 요청**:
   - POST /api/events 호출
   - 요청 본문에 EventForm 데이터 포함

2. **성공 응답 시**:
   - 서버가 UUID 생성하여 Event 반환
   - 클라이언트 일정 목록에 새 일정 추가
   - 성공 알림 표시: "일정이 추가되었습니다." (notistack)

3. **UI 업데이트**:
   - 일정 목록(우측)에 새 일정 표시
   - 캘린더 뷰에 새 일정 표시 (해당 날짜 셀)
   - 폼이 초기 상태로 리셋

4. **폼 리셋 상태**:
   - 모든 텍스트 필드 빈 문자열
   - 카테고리 "업무"로 초기화
   - 알림 설정 "10분 전"으로 초기화

#### 테스트 위치
- `src/__tests__/medium.integration.spec.tsx:58-80`

---

### 시나리오 2: 필수 필드 누락 시 생성 실패

#### Given
- 사용자가 일정 추가 폼에 있음

#### When
1. 제목 필드를 비워둠
2. 날짜만 "2025-10-27" 입력
3. "일정 추가" 버튼 클릭

#### Then
1. **검증 실패**:
   - 에러 알림 표시: "필수 정보를 모두 입력해주세요."
   - 서버 요청 전송되지 않음

2. **UI 상태**:
   - 폼 데이터 유지 (입력한 날짜 보존)
   - 포커스는 변경되지 않음
   - 일정 목록 변화 없음

---

### 시나리오 3: 시간 검증 실패 시 생성 실패

#### Given
- 사용자가 일정 추가 폼에 있음

#### When
1. 제목: "회의" 입력
2. 날짜: "2025-10-27" 입력
3. 시작 시간: "15:00" 입력
4. 종료 시간: "14:00" 입력 (시작보다 빠름)
5. 종료 시간 필드에서 포커스 아웃 (onBlur)

#### Then
1. **실시간 검증**:
   - 시작 시간 필드 하단에 툴팁 표시: "시작 시간은 종료 시간보다 빨라야 합니다."
   - 종료 시간 필드 하단에 툴팁 표시: "종료 시간은 시작 시간보다 늦어야 합니다."
   - 두 필드 모두 에러 상태 (빨간 테두리)

2. **제출 시도**:
   - "일정 추가" 버튼 클릭
   - 에러 알림 표시: "시간 설정을 확인해주세요."
   - 서버 요청 전송되지 않음

---

### 시나리오 4: 일정 겹침 경고 후 생성

#### Given
- 기존 일정 존재:
  - 날짜: "2025-10-27"
  - 시간: "14:00-16:00"
  - 제목: "기존 회의"

#### When
1. 새 일정 입력:
   - 제목: "긴급 회의"
   - 날짜: "2025-10-27"
   - 시작 시간: "15:00"
   - 종료 시간: "17:00"
2. "일정 추가" 버튼 클릭

#### Then
1. **겹침 감지**:
   - 다이얼로그 표시: "일정 겹침 경고"
   - 겹치는 일정 정보 표시: "기존 회의 (2025-10-27 14:00-16:00)"
   - 선택지 제공: "취소" / "계속 진행"

2. **사용자가 "계속 진행" 선택**:
   - 다이얼로그 닫힘
   - 서버에 일정 생성 요청
   - 일정 목록에 두 일정 모두 표시
   - 캘린더에서 두 일정이 겹쳐 표시됨

3. **사용자가 "취소" 선택**:
   - 다이얼로그 닫힘
   - 폼 데이터 유지
   - 일정 생성되지 않음

---

## WF-02: 일정 수정 워크플로우

### 시나리오 1: 정상적인 일정 수정

#### Given
- 일정 목록에 일정이 하나 이상 존재
- 예시 일정:
  ```typescript
  {
    id: 'test-event-1',
    title: '팀 회의',
    date: '2025-10-27',
    startTime: '14:00',
    endTime: '15:00',
    description: '기존 설명',
    location: '회의실 A',
    category: '업무',
    repeat: { type: 'none', interval: 1 },
    notificationTime: 10
  }
  ```

#### When
1. 우측 일정 목록에서 "Edit event" 버튼(연필 아이콘) 클릭
2. 좌측 폼에 기존 데이터 자동 입력됨
3. 폼 제목이 "일정 수정"으로 변경됨
4. 제목을 "수정된 회의"로 변경
5. 설명을 "회의 내용 변경"으로 변경
6. "일정 수정" 버튼 클릭

#### Then
1. **서버 요청**:
   - PUT /api/events/:id 호출
   - 요청 본문에 수정된 EventForm 데이터 포함

2. **성공 응답 시**:
   - 일정 목록에서 해당 일정이 수정된 내용으로 업데이트
   - 성공 알림 표시: "일정이 수정되었습니다."

3. **UI 업데이트**:
   - 일정 목록에 수정된 제목 "수정된 회의" 표시
   - 일정 목록에 수정된 설명 "회의 내용 변경" 표시
   - 캘린더 뷰에도 변경 사항 반영
   - 폼은 수정 모드 유지 (editingEvent 상태 유지)

4. **폼 상태**:
   - 폼은 초기화되지 않음
   - 제목은 "일정 수정" 유지
   - 버튼 텍스트는 "일정 수정" 유지

#### 테스트 위치
- `src/__tests__/medium.integration.spec.tsx:82-99`

---

### 시나리오 2: 수정 중 취소

#### Given
- 일정이 수정 모드로 폼에 로드됨

#### When
1. 일부 필드를 수정함
2. 폼 외부의 다른 일정 "Edit event" 버튼 클릭

#### Then
- 새로운 일정의 데이터로 폼이 교체됨
- 이전 수정 내용은 저장되지 않음
- 별도의 확인 다이얼로그 없음

---

## WF-03: 일정 삭제 워크플로우

### 시나리오 1: 정상적인 일정 삭제

#### Given
- 일정 목록에 일정이 하나 이상 존재
- 예시 일정:
  ```typescript
  {
    id: 'test-event-1',
    title: '삭제할 회의',
    date: '2025-10-27',
    startTime: '14:00',
    endTime: '15:00',
    // ... 기타 필드
  }
  ```

#### When
1. 우측 일정 목록에서 "Delete event" 버튼(휴지통 아이콘) 클릭

#### Then
1. **즉시 삭제 (확인 없음)**:
   - DELETE /api/events/:id 호출

2. **성공 응답 시**:
   - 일정 목록에서 해당 일정 제거
   - 알림 표시: "일정이 삭제되었습니다." (info 레벨)

3. **UI 업데이트**:
   - 일정 목록에서 사라짐
   - 캘린더 뷰에서도 사라짐
   - 폼 상태는 유지 (삭제가 폼에 영향 없음)

---

### 시나리오 2: 수정 중인 일정 삭제

#### Given
- 일정이 수정 모드로 폼에 로드됨
- `editingEvent` 상태에 해당 일정 저장됨

#### When
1. "Delete event" 버튼 클릭

#### Then
1. 일정 삭제 (위와 동일)
2. **폼 상태**:
   - `editingEvent`는 null로 변경되지 않음
   - 폼 데이터는 그대로 유지
   - 사용자가 "일정 추가" 버튼 클릭 시 에러 발생 가능 (id가 더 이상 유효하지 않음)

**권장 개선**: 삭제 시 폼 초기화 (`setEditingEvent(null)`, `resetForm()`)

---

## WF-04: 일정 검색 워크플로우

### 시나리오 1: 제목으로 검색

#### Given
- 여러 일정이 존재:
  - "팀 회의" (2025-10-27)
  - "점심 약속" (2025-10-27)
  - "개인 프로젝트" (2025-10-28)

#### When
1. 우측 상단 "일정 검색" 필드에 "회의" 입력

#### Then
1. **실시간 필터링**:
   - 입력할 때마다 즉시 필터링
   - "팀 회의"만 목록에 표시
   - 다른 일정들은 숨김

2. **대소문자 무시**:
   - "회의", "회의", "MEETING" 모두 매칭

---

### 시나리오 2: 검색 결과 없음

#### Given
- 여러 일정이 존재하지만 검색어와 일치하는 것 없음

#### When
1. "일정 검색" 필드에 "존재하지않음" 입력

#### Then
1. **빈 상태 표시**:
   - "검색 결과가 없습니다." 메시지 표시
   - 일정 목록 비어있음

---

### 시나리오 3: 검색어 지우기

#### Given
- 검색어 "회의" 입력되어 일부 일정만 표시 중

#### When
1. 검색어 전체 삭제 (빈 문자열)

#### Then
- 모든 일정이 다시 목록에 표시됨
- 현재 뷰(주간/월간)의 날짜 범위 내 일정만 표시

---

## WF-05: 캘린더 뷰 전환 워크플로우

### 시나리오 1: 주간 뷰 → 월간 뷰

#### Given
- 현재 주간 뷰 표시 중
- 날짜: 2025년 10월 27일 주 (10월 26일 ~ 11월 1일)

#### When
1. 중앙 상단 뷰 선택 드롭다운 클릭
2. "Month" 옵션 선택

#### Then
1. **뷰 전환**:
   - 월간 달력으로 전환
   - 2025년 10월 전체 표시
   - 각 날짜 셀에 해당 일정 표시

2. **공휴일 표시**:
   - 공휴일이 있는 날짜에 공휴일 이름 표시 (빨간색)
   - 예: "10월 3일 - 개천절"

---

### 시나리오 2: 월간 뷰 → 주간 뷰

#### Given
- 현재 월간 뷰 표시 중 (2025년 10월)

#### When
1. 뷰 선택 드롭다운에서 "Week" 선택

#### Then
- 주간 달력으로 전환
- 현재 주 (오늘 날짜 포함 주) 표시
- 일주일 단위로 일정 표시

---

### 시나리오 3: 이전/다음 주/월 네비게이션

#### Given
- 주간 뷰: 2025년 10월 27일 주

#### When
1. 좌측 화살표 버튼 클릭

#### Then
- 이전 주 (10월 19일 ~ 10월 25일) 표시
- 해당 기간의 일정만 캘린더에 표시
- 우측 일정 목록도 해당 기간 일정으로 필터링

#### Given
- 월간 뷰: 2025년 10월

#### When
1. 우측 화살표 버튼 클릭

#### Then
- 다음 달 (2025년 11월) 표시
- 해당 월의 모든 일정 표시

---

## WF-06: 일정 겹침 경고 처리 워크플로우

### 시나리오 1: 겹침 경고 후 취소

#### Given
- 기존 일정: 2025-10-27, 10:00-12:00
- 새 일정 입력: 2025-10-27, 11:00-13:00

#### When
1. "일정 추가" 버튼 클릭
2. 겹침 경고 다이얼로그 표시
3. "취소" 버튼 클릭

#### Then
1. **다이얼로그 닫힘**
2. **폼 상태 유지**:
   - 입력한 모든 데이터 보존
   - 사용자가 시간을 수정하여 재시도 가능
3. **일정 생성 안 됨**

---

### 시나리오 2: 겹침 경고 무시하고 진행

#### Given
- 기존 일정: 2025-10-27, 10:00-12:00
- 새 일정 입력: 2025-10-27, 11:00-13:00

#### When
1. "일정 추가" 버튼 클릭
2. 겹침 경고 다이얼로그 표시
3. "계속 진행" 버튼 클릭

#### Then
1. **다이얼로그 닫힘**
2. **일정 생성**:
   - POST /api/events 호출
   - 서버에 일정 저장
   - 일정 목록에 추가
3. **겹침 상태 유지**:
   - 두 일정 모두 캘린더에 표시
   - 추후 수정 시에도 겹침 경고 재표시

---

## 참조

- **관련 명세**:
  - [02. 비즈니스 규칙](./02-business-rules.md): 각 워크플로우의 비즈니스 로직
  - [05. 검증 규칙](./05-validation-rules.md): 입력 검증 단계
  - [08. 테스트 시나리오](./08-test-scenarios.md): 워크플로우 테스트 케이스

---

**다음 문서**: [04. API 명세](./04-api-specification.md)
